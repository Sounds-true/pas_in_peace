# PAS Bot - Parental Alienation Support Bot

Терапевтический бот для поддержки родителей, столкнувшихся с отчуждением детей.

## Архитектура

### Основные компоненты:
- **LangGraph** - оркестрация состояний диалога
- **NeMo Guardrails** - безопасность и границы
- **SuicidalBERT** - детекция кризисных ситуаций
- **GoEmotions** - определение эмоционального состояния
- **Haystack + Qdrant** - RAG для базы знаний
- **Guardrails AI** - валидация структуры ответов
- **Presidio + Natasha** - защита персональных данных

## Установка

### Требования:
- Python 3.10+
- PostgreSQL
- Redis

### Шаги установки:

1. Клонировать репозиторий:
```bash
git clone <repository-url>
cd PAS_Bot
```

2. Создать виртуальное окружение:
```bash
python -m venv venv
source venv/bin/activate  # Linux/Mac
# или
venv\Scripts\activate  # Windows
```

3. Установить зависимости:
```bash
pip install -r requirements.txt
```

4. Настроить переменные окружения:
```bash
cp .env.example .env
# Отредактировать .env и добавить ваши ключи
```

5. Создать базу данных:
```bash
createdb pas_bot
```

6. Запустить миграции:
```bash
alembic upgrade head
```

7. Загрузить модель для русского языка:
```bash
python -m spacy download ru_core_news_sm
```

## Запуск

### Режим разработки (polling):
```bash
python main.py
```

### Режим production (webhook):
```bash
ENVIRONMENT=production python main.py
```

## Структура проекта

```
PAS_Bot/
├── src/
│   ├── core/           # Основная функциональность
│   │   ├── bot.py      # Telegram бот
│   │   ├── config.py   # Конфигурация
│   │   └── logger.py   # Логирование
│   ├── safety/         # Модуль безопасности
│   │   ├── crisis_detector.py     # Детекция кризисов
│   │   └── guardrails_manager.py  # NeMo Guardrails
│   ├── orchestration/  # Управление состояниями
│   │   └── state_manager.py  # LangGraph состояния
│   ├── nlp/           # NLP модули
│   ├── storage/       # Хранение данных
│   └── api/           # API endpoints
├── config/
│   ├── guardrails/    # Конфигурация Guardrails
│   │   └── rails.colang  # Политики безопасности
│   └── langraph/      # Конфигурация LangGraph
│       └── graph.yaml    # Граф состояний
├── data/              # Данные и логи
├── tests/             # Тесты
└── scripts/           # Вспомогательные скрипты
```

## Фазы терапии

1. **CRISIS** (1-2 недели) - Стабилизация и безопасность
2. **UNDERSTANDING** (2-4 недели) - Эмоциональная обработка
3. **ACTION** (4-8 недель) - Развитие навыков
4. **SUSTAINABILITY** (постоянно) - Поддержание прогресса

## Основные функции

### Безопасность:
- Автоматическая детекция кризисных ситуаций
- Мгновенное предоставление контактов экстренной помощи
- Блокировка опасных тем через Guardrails
- Защита персональных данных

### Терапевтические техники:
- CBT (когнитивно-поведенческая терапия)
- NVC (ненасильственная коммуникация)
- IFS (терапия внутренних семейных систем)
- MI (мотивационное интервьюирование)

### Написание писем:
- Структурированный процесс создания
- Проверка на BIFF принципы
- Сохранение черновиков
- Капсулы времени

### Отслеживание целей:
- Постановка SMART целей
- Мониторинг прогресса
- Выявление блокеров
- Празднование достижений

## Команды бота

- `/start` - Начать диалог
- `/help` - Помощь
- `/crisis` - Экстренная помощь
- `/letter` - Написать письмо
- `/goals` - Мои цели
- `/resources` - Полезные ресурсы
- `/privacy` - Конфиденциальность

## Мониторинг

Бот использует структурированное логирование через structlog. Логи сохраняются в `data/logs/`.

### Метрики:
- Эмоциональная интенсивность
- Кризисные инциденты
- Используемые техники
- Завершенные цели
- Написанные письма
- Вовлеченность

## Безопасность

- Все данные шифруются
- PII автоматически удаляется
- Соответствие GDPR и 152-ФЗ
- Zero-PII политика на сервере

## Разработка

### Запуск тестов:
```bash
pytest
```

### Форматирование кода:
```bash
black src/
ruff check src/
```

### Проверка типов:
```bash
mypy src/
```

## Лицензия

Proprietary - Все права защищены

## Поддержка

При возникновении проблем создайте issue в репозитории.