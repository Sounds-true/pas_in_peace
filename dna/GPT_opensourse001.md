Llm-integration-catalog

Название: Каталог опенсорс-инструментов для интеграции в архитектуру терапевтического бота

Цель: на основе выбранной архитектуры (IP‑01–IP‑08) собрать зрелые open-source инструменты (репозитории, модели, пайплайны), которые можно быстро и безопасно интегрировать в систему: от guardrails и RAG до JITAI, BIFF/NVC-переписывания писем и модулей оценки качества. Перевод на русский + комментарии по интеграции для каждого модуля.

Формат:

Название

Назначение

Лицензия / зрелость / активность

Как интегрировать в архитектуру IP

Что закрывает в graph.yaml / rails.colang / eval

Рекомендации по имплементации

A. Оркестрация и policy-as-code

LangGraph (MIT)
Назначение: построение управляемых графов диалога, где узлы — агенты или функции. Используется для построения многосценарных цепочек (например: CHECK_EMOTION -> OFFER_CBT -> WRITE_LETTER).
Интеграция: граф yaml можно перенести в LangGraph как объект с узлами и переходами; один узел = Chain или Tool. Хорошо встраивается в BESSER как backend-движок.
Рекомендуем: использовать для реализации WRITE_LETTER_GRIEF, SAFETY_ESCALATION и STATE_RETRY логики.

pyTransitions (MIT)
Назначение: лёгкая Python-библиотека конечных автоматов (FSM), подходит для детерминированных flows (например, CRISIS_CHECK).
Интеграция: как вспомогательный механизм для жестких ветвлений — DIFF_DIAG_GATE, SAFETY_CHECK. Использовать как вспомогательный DSL, если не хочется тянуть Rasa.

Rasa (Apache 2.0)
Назначение: зрелая FSM‑платформа, включает интенты, слоты, NLU. Может использоваться для создания структурированной психотерапевтической сессии.
Интеграция: в связке с LangChain и LangGraph может выступать как фронт NLP/FSM, а дальше передавать control в LangChain chains.

B. Guardrails / безопасность

NeMo Guardrails (Apache 2.0)
Назначение: DSL (Colang) для управления диалогом и блокировки нежелательных тем.
Интеграция: rails.colang может использоваться для запрета тем (юридическая консультация, насилие, манипуляции). Подходит для реализации узлов SAFETY_BLOCK, CRISIS_RAIL.

Guardrails-AI (Apache 2.0)
Назначение: проверка структуры и содержания LLM-ответов (JSON, тон, вежливость, PII).
Интеграция: как слой postprocessing. После генерации письма — прогон через schema + validator: не допускаем агрессии, утечки, неструктурированных ответов.

Garak (Apache 2.0)
Назначение: red-teaming фреймворк — сканирует LLM на уязвимости (jailbreak, обход guardrails).
Интеграция: запускать в CI как регулярный тест на безопасность. Подходит для regression-тестов перед релизом новых prompt шаблонов.

Presidio (MIT)
Назначение: обнаружение PII (имена, email, телефоны), поддержка RU через кастомные recognizers.
Интеграция: вставить в preprocessor (input/user text) и postprocessor (LLM output). Полезно для LETTER_WRITING, EPISODIC_MEMORY, LOGGING.

C. RAG и память

Haystack (Apache 2.0)
Назначение: фреймворк для построения RAG: document store + retriever + reranker + LLM.
Интеграция: подключается как RAG‑платформа в слое KNOWLEDGE_LAYER (см. IP‑08). Можно использовать Chroma/Qdrant + Retriever из Haystack + LangChain QA chain.
Закрывает узлы: FACTUAL_SUPPORT, LAW_QUERY, CONTEXTUAL_EXAMPLES.

RAGAS (MIT)
Назначение: оценка качества RAG (точность, основание, faithfulness).
Интеграция: запускать в CI, проверка новых источников или fine-tune моделей. Используется для CI на узлы типа KNOWLEDGE_REPLY.

D. Переписывание писем (NVC, BIFF, вежливость)

Proselint (MIT)
Назначение: линтер для текста (фактические и стилевые ошибки, в том числе токсичность, категоричность, «wateriness»).
Интеграция: postprocessing писем. Узел LETTER_REVIEW: проверка на качество/вежливость до отображения пользователю. Модульно встраивается.

BIFF/NVC Prompt Templates (на базе GPT-4)
Назначение: преобразование текста во вежливую форму по формату BIFF / NVC.
Интеграция: можно оформить как шаблоны prompt-ов (LETTER_REWRITE_NVC, LETTER_REWRITE_BIFF). Можно связать с классификатором tone и фильтром PII.

E. Эмоции / кризис / эмпатия

GoEmotions classifier (HuggingFace)
Назначение: классификация по 27 эмоциональным категориям.
Интеграция: используется в эмоциональном слое STATE_DETECTOR (см. IP‑03). Определяет эмоциональный узел в графе.

SuicidalBERT (HuggingFace)
Назначение: классификатор на риск суицида.
Интеграция: используется в DIFF_DIAG_GATE. Срабатывает на ввод и может менять маршрут в графе на CRISIS_FLOW или ESCALATION.

Detoxify (MIT)
Назначение: токсичность (обида, угрозы, оскорбления).
Интеграция: использовать в предобработке input и postprocessing output. Узлы типа SAFETY_PRECHECK, CONTENT_VALIDATOR.

F. Оценка / трассировка

Promptfoo (MIT)
Назначение: фреймворк для тестирования prompt-ов (A/B, CI, fuzzing).
Интеграция: настроить сценарии test_cases/ (DIFF_DIAG, LETTER_NVC, LETTER_BIFF, CRISIS). Подключить в CI. Можно задать assert: ответ должен содержать ключевые фразы или избегать их.

OpenAI Evals (MIT)
Назначение: создание тестов, сравнение моделей, регресс-тестинг.
Интеграция: сделать кастомные eval-ы на основе сценариев из IP-04 и IP-05 (crisis handling, cognitive reframe, etc.).

Trulens (Apache 2.0)
Назначение: трассировка и оценка качества цепочек (LLM pipeline).
Интеграция: обернуть LangChain-цепочки. Использовать с LangSmith или OpenTelemetry. Включить в observability.

G. JITAI и адаптивные касания

MABWiser (Apache 2.0)
Назначение: contextual bandit фреймворк.
Интеграция: реализовать personalized intervention selector (WRITE_LETTER vs WAIT vs CBT). Хранить контексты (настроение, engagement). Обновлять reward после каждой сессии.

APScheduler
Назначение: расписание задач.
Интеграция: можно использовать для планирования «мягких касаний» (LETTER_REMINDER, WEEKLY_GOAL_CHECK) или delayed intervention (если LLM рекомендует «завтра»).

H. PII и приватность

Presidio (MIT)
Назначение: детекция и редактирование PII.
Интеграция: слой до логирования или сохранения LETTER/EPISODE. Также полезен для экспорта по GDPR (IP‑07).

Natasha (MIT)
Назначение: морфология и NER для русского.
Интеграция: дополнение к Presidio — распознаёт русские имена, местоположения, фамилии. Использовать в SAFETY_PRECHECK и PII_CLEANER.

I. Мультиагентные фреймворки

CrewAI (MIT)
Назначение: оркестровка агентов (ассистент, safety, critic) в одной задаче.
Интеграция: можно реализовать supervisor agent для контроля эмпатии или безопасности. Также: LETTER_CRITIC_AGENT перед финализацией письма.

AutoGen (MIT)
Назначение: фреймворк от Microsoft для автономных/мультиагентных систем.
Интеграция: подойдёт для симуляций терапии (терапевт-клиент) или разделения ролей (retriever, rewriter, checker).

J. RU-контекст и локализация

GoEmotions на русском
Назначение: классификация эмоций в RU.
Интеграция: использовать в STATE_DETECTOR. Возможно — кастомная дообученная версия с RU-корпусами.

BIFF/NVC на русском (шаблоны)
Назначение: генерация писем в русском стиле.
Интеграция: разработать локализованные prompt-ы. Собирать примеры писем, поддерживающие BIFF/NVC, и использовать как few-shot или templates.

Письма в школу / медиация (PDF/doc)
Назначение: примеры документов.
Интеграция: загружать в RAG векторную базу. Использовать retrieval при генерации писем, либо как справочные шаблоны.

Дополнительно:

eval/: добавить promptfoo и OpenAI Evals для CI-тестов сценариев (на базе IP‑06).

rails.colang: завести правила для тем (насилие, юридическая помощь) и регионов (ЕС — не давать советы).

reply.schema.json: определить структуру ответа (text, emotion, action, reasoning, source).

observability/: подключить LangSmith и Trulens, логировать метрики (emotion shifts, goal progress).

graph.yaml: расширить узлами LETTER_REVIEW, BIFF_REWRITE, SAFETY_ESCALATION, STATE_RETRY.

После включения этих модулей — бот приобретает свойства: управляемости, безопасности, наблюдаемости и адаптивности. При этом большинство интеграций возможны без слома архитектуры.

(при необходимости можно развернуть каждую категорию отдельно или сформировать задачи на имплементацию — дай знать)