# Sprint 9: Telegraph Letters - –°–∏—Å—Ç–µ–º–∞ –ø–∏—Å—å–º–µ–Ω–Ω–æ–π —Ç–µ—Ä–∞–ø–∏–∏

## –û–±–∑–æ—Ä

Sprint 9 —Ä–µ–∞–ª–∏–∑—É–µ—Ç —Å–∏—Å—Ç–µ–º—É –ø–∏—Å—å–º–µ–Ω–Ω—ã—Ö –ø—Ä–∞–∫—Ç–∏–∫ –¥–ª—è —Ä–æ–¥–∏—Ç–µ–ª–µ–π —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å Telegraph.ph. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ç—Ä–∏ —Ç–∏–ø–∞ –ø–∏—Å–µ–º —Å —Ä–∞–∑–Ω—ã–º —É—Ä–æ–≤–Ω–µ–º –∫–æ–Ω—Ç—Ä–æ–ª—è —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç–∏, –≥–æ–ª–æ—Å–æ–≤–æ–π –¥–∏–∫—Ç–æ–≤–∫–æ–π –∏ –∫—Ä–∞—Å–∏–≤—ã–º —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–º.

## –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### 1. –¢—Ä–∏ —Ç–∏–ø–∞ –ø–∏—Å–µ–º

**üì§ FOR_SENDING** - –ü–∏—Å—å–º–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
- –î–ª—è –±—ã–≤—à–µ–≥–æ –ø–∞—Ä—Ç–Ω–µ—Ä–∞, —à–∫–æ–ª—ã, —Å—É–¥–∞
- –°—Ç—Ä–æ–≥–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç–∏ (–ø–æ—Ä–æ–≥ 30%)
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Å–º—è–≥—á–µ–Ω–∏—é —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–æ–∫
- –¶–µ–ª—å: –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω–∞—è –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è

**üéÅ TIME_CAPSULE** - –ö–∞–ø—Å—É–ª—ã –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è —Ä–µ–±–µ–Ω–∫–∞
- –ü–∏—Å—å–º–∞, –∫–æ—Ç–æ—Ä—ã–µ —Ä–µ–±–µ–Ω–æ–∫ –ø—Ä–æ—á—Ç–µ—Ç –≤ –±—É–¥—É—â–µ–º
- –°—Ä–µ–¥–Ω–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å (–ø–æ—Ä–æ–≥ 50%)
- –ó–∞—â–∏—Ç–∞ –æ—Ç –∑–∞–ø–∏—Å–∏ –æ–±–∏–¥ –∏ –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–π
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, –∫–æ–≥–¥–∞ —Ä–æ–¥–∏—Ç–µ–ª—å —É—Å–ø–æ–∫–æ–∏—Ç—Å—è

**üí≠ THERAPEUTIC** - –¢–µ—Ä–∞–ø–µ–≤—Ç–∏—á–µ—Å–∫–∏–µ –ø–∏—Å—å–º–∞
- –õ–∏—á–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –¥–ª—è –≤—ã—Ä–∞–∂–µ–Ω–∏—è —ç–º–æ—Ü–∏–π
- –ë–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π (–ø–æ—Ä–æ–≥ 100%)
- –ü–æ–ª–Ω–∞—è —Å–≤–æ–±–æ–¥–∞ –≤—ã—Å–∫–∞–∑—ã–≤–∞–Ω–∏—è
- –ü—Ä–∏–≤–∞—Ç–Ω–æ–µ, –Ω–∏–∫—Ç–æ –Ω–µ —É–≤–∏–¥–∏—Ç

### 2. –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç–∏

**–î–≤—É—Ö—ç—Ç–∞–ø–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞:**

1. **Detoxify** - –±—ã—Å—Ç—Ä–∞—è ML-–º–æ–¥–µ–ª—å
   - –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç 6 –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç–∏
   - –†–∞–±–æ—Ç–∞–µ—Ç –æ—Ñ–ª–∞–π–Ω
   - –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ

2. **LLM (GPT-4)** - –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑
   - –ù–∞—Ö–æ–¥–∏—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ç–æ–∫—Å–∏—á–Ω—ã–µ —Ñ—Ä–∞–∑—ã
   - –î–∞—ë—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–µ
   - –ü—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã

**–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç–∏:**
- –û—Å–∫–æ—Ä–±–ª–µ–Ω–∏—è (—Å—É–∫–∞, —Å–≤–æ–ª–æ—á—å, —É–±–ª—é–¥–æ–∫)
- –£–≥—Ä–æ–∑—ã (–∑–∞–ø–ª–∞—Ç–∏—à—å, –ø–æ–∂–∞–ª–µ–µ—à—å)
- –û–±–≤–∏–Ω–µ–Ω–∏—è (—Ç—ã –≤–∏–Ω–æ–≤–∞—Ç, –∏–∑-–∑–∞ —Ç–µ–±—è)
- –ú–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏ (—Ä–µ–±—ë–Ω–æ–∫ –Ω–µ —Ö–æ—á–µ—Ç, —Ä–µ–±—ë–Ω–æ–∫ –±–æ–∏—Ç—Å—è)

### 3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Telegraph

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- –ö—Ä–∞—Å–∏–≤—ã–π rich-text —Ä–µ–¥–∞–∫—Ç–æ—Ä
- –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ UUID-—Å—Å—ã–ª–∫–∏
- –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
- –°—Ç–∞—Ç—å–∏ –Ω–µ –∏–Ω–¥–µ–∫—Å–∏—Ä—É—é—Ç—Å—è –ø–æ–∏—Å–∫–æ–≤–∏–∫–∞–º–∏
- –°—Å—ã–ª–∫–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç UUID (—Å–ª–æ–∂–Ω–æ —É–≥–∞–¥–∞—Ç—å)
- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –ø—É–±–ª–∏—á–Ω–æ—Å—Ç–∏
- –£–¥–∞–ª–µ–Ω–∏–µ PII –ø–µ—Ä–µ–¥ –ø—É–±–ª–∏–∫–∞—Ü–∏–µ–π

### 4. –ì–æ–ª–æ—Å–æ–≤–∞—è –¥–∏–∫—Ç–æ–≤–∫–∞

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
2. –°–∏—Å—Ç–µ–º–∞ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä—É–µ—Ç —á–µ—Ä–µ–∑ Speech-to-Text
3. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–µ–≤—å—é —Å –∫–Ω–æ–ø–∫–∞–º–∏ "–í—Å—ë –≤–µ—Ä–Ω–æ?" / "–ò–∑–º–µ–Ω–∏—Ç—å"
4. –ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç—å
5. –°–æ–∑–¥–∞—ë—Ç Telegraph —Å—Ç–∞—Ç—å—é

### 5. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–∞–ø—Å—É–ª

**–£–º–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:**
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Ç–æ–∫—Å–∏—á–Ω—ã–µ –∫–∞–ø—Å—É–ª—ã —Å –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è–º–∏
- –ñ–¥—ë—Ç 24+ —á–∞—Å–æ–≤ –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –£–≤–µ–¥–æ–º–ª—è–µ—Ç, –∫–æ–≥–¥–∞ distress < 0.4 (—Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ)
- –ü—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å –∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

```
src/
‚îú‚îÄ‚îÄ letters/
‚îÇ   ‚îú‚îÄ‚îÄ types.py                  # –¢–∏–ø—ã –ø–∏—Å–µ–º, –ø–æ—Ä–æ–≥–∏
‚îÇ   ‚îú‚îÄ‚îÄ toxicity_checker.py       # Detoxify + LLM
‚îÇ   ‚îú‚îÄ‚îÄ enhanced_writer.py        # –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞
‚îÇ   ‚îî‚îÄ‚îÄ capsule_monitor.py        # –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
‚îú‚îÄ‚îÄ integrations/
‚îÇ   ‚îî‚îÄ‚îÄ telegraph_client.py       # API Telegraph
‚îî‚îÄ‚îÄ core/
    ‚îî‚îÄ‚îÄ letter_handlers.py        # Telegram –±–æ—Ç –∫–æ–º–∞–Ω–¥—ã
```

### –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
    ‚Üì
/write_letter (Telegram)
    ‚Üì
–í—ã–±–æ—Ä —Ç–∏–ø–∞ –ø–∏—Å—å–º–∞ (keyboard)
    ‚Üì
–ì–æ–ª–æ—Å –∏–ª–∏ —Ç–µ–∫—Å—Ç
    ‚Üì
–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è (–µ—Å–ª–∏ –≥–æ–ª–æ—Å)
    ‚Üì
–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞
    ‚Üì
–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç–∏ (Detoxify + LLM)
    ‚Üì
–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ + —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
    ‚Üì
–í—ã–±–æ—Ä: –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å / —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å
    ‚Üì
–°–æ–∑–¥–∞–Ω–∏–µ Telegraph —Å—Ç–∞—Ç—å–∏
    ‚Üì
–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î
    ‚Üì
–í–æ–∑–≤—Ä–∞—Ç —Å—Å—ã–ª–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
```

### –°–æ—Å—Ç–æ—è–Ω–∏—è ConversationHandler

```python
CHOOSING_TYPE = 0       # –í—ã–±–æ—Ä —Ç–∏–ø–∞ –ø–∏—Å—å–º–∞
WRITING_DRAFT = 1       # –ù–∞–ø–∏—Å–∞–Ω–∏–µ/–¥–∏–∫—Ç–æ–≤–∫–∞
REVIEWING_TOXICITY = 2  # –ü—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

**/write_letter** - –ù–∞—á–∞—Ç—å –Ω–∞–ø–∏—Å–∞–Ω–∏–µ –ø–∏—Å—å–º–∞
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—ã–±–æ—Ä —Ç–∏–ø–∞
- –ó–∞–ø—É—Å–∫–∞–µ—Ç conversation flow

**/my_letters** - –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–≤–æ–∏ –ø–∏—Å—å–º–∞
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ –ø–∏—Å—å–º–∞ —Å Telegraph —Å—Å—ã–ª–∫–∞–º–∏
- –ì—Ä—É–ø–ø–∏—Ä—É–µ—Ç –ø–æ —Ç–∏–ø—É

### –ü—Ä–∏–º–µ—Ä –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: /write_letter

–ë–æ—Ç: –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –ø–∏—Å—å–º–∞:
     [üì§ –î–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏]
     [üéÅ –ö–∞–ø—Å—É–ª–∞ –¥–ª—è —Ä–µ–±—ë–Ω–∫–∞]
     [üí≠ –¢–µ—Ä–∞–ø–µ–≤—Ç–∏—á–µ—Å–∫–æ–µ]

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: [–Ω–∞–∂–∏–º–∞–µ—Ç "–ö–∞–ø—Å—É–ª–∞ –¥–ª—è —Ä–µ–±—ë–Ω–∫–∞"]

–ë–æ—Ç: –û—Ç–ª–∏—á–Ω–æ! –≠—Ç–æ –ø–∏—Å—å–º–æ –¥–ª—è –≤–∞—à–µ–≥–æ —Ä–µ–±—ë–Ω–∫–∞ –≤ –±—É–¥—É—â–µ–º.
     –ù–∞–ø–∏—à–∏—Ç–µ –∏–ª–∏ –Ω–∞–¥–∏–∫—Ç—É–π—Ç–µ —Ç–µ–∫—Å—Ç...

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: [–æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≥–æ–ª–æ—Å–æ–≤–æ–µ]

–ë–æ—Ç: –í–æ—Ç —á—Ç–æ —è —É—Å–ª—ã—à–∞–ª:
     "–ú–∏–ª–∞—è –¥–æ—á–∫–∞, –∫–æ–≥–¥–∞ —Ç—ã –≤—ã—Ä–∞—Å—Ç–µ—à—å..."

     –í—Å—ë –≤–µ—Ä–Ω–æ?
     [‚úÖ –î–∞, –≤—Å—ë –≤–µ—Ä–Ω–æ] [‚úèÔ∏è –ù—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å]

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: [–Ω–∞–∂–∏–º–∞–µ—Ç "–î–∞"]

–ë–æ—Ç: [–ï—Å–ª–∏ —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç—å > 50%]
     ‚ö†Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ —Ç–æ–∫—Å–∏—á–Ω—ã–µ —Ñ—Ä–∞–∑—ã:

     "–∏–∑-–∑–∞ —Ç–≤–æ–µ–π –º–∞—Ç–µ—Ä–∏" (–æ–±–≤–∏–Ω–µ–Ω–∏–µ)

     –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: "–∏–∑-–∑–∞ —Å–∏—Ç—É–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä–∞—è —Å–ª–æ–∂–∏–ª–∞—Å—å"

     [‚úèÔ∏è –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å] [üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å]

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: [–≤—ã–±–∏—Ä–∞–µ—Ç –¥–µ–π—Å—Ç–≤–∏–µ]

–ë–æ—Ç: ‚úÖ –ü–∏—Å—å–º–æ —Å–æ–∑–¥–∞–Ω–æ!
     üìù https://telegra.ph/...

     –í—ã –º–æ–∂–µ—Ç–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –µ–≥–æ –ø–æ —ç—Ç–æ–π —Å—Å—ã–ª–∫–µ.
```

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ú–æ–¥–µ–ª—å Letter –≤ –ë–î

```python
class Letter(Base):
    # –û—Å–Ω–æ–≤–Ω–æ–µ
    user_id = Column(Integer, ForeignKey('users.id'))
    title = Column(String(500))
    content = Column(Text)

    # –¢–∏–ø –ø–∏—Å—å–º–∞ (NEW)
    letter_type = Column(String(50), default="for_sending")
    purpose = Column(String(100))
    style = Column(String(50))

    # –¢–æ–∫—Å–∏—á–Ω–æ—Å—Ç—å (NEW)
    toxicity_score = Column(Float)
    toxicity_details = Column(JSON)
    toxicity_warnings_ignored = Column(Boolean, default=False)

    # Telegraph (NEW)
    telegraph_url = Column(String(500))
    telegraph_path = Column(String(200))
    telegraph_access_token = Column(String(200))
    telegraph_versions = Column(JSON, default=list)

    # –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
    created_at = Column(DateTime, default=datetime.utcnow)
    updated_at = Column(DateTime, onupdate=datetime.utcnow)
```

### LetterSession (–≤ –ø–∞–º—è—Ç–∏)

```python
@dataclass
class LetterSession:
    user_id: str
    letter_type: LetterType
    stage: LetterStage
    draft_text: Optional[str] = None
    transcribed_text: Optional[str] = None
    toxicity_analysis: Optional[ToxicityAnalysis] = None
    telegraph_data: Optional[Dict] = None
    created_at: datetime = field(default_factory=datetime.utcnow)
```

### ToxicityAnalysis

```python
@dataclass
class ToxicityAnalysis:
    is_toxic: bool
    overall_score: float
    category_scores: Dict[str, float]
    toxic_phrases: List[Dict[str, Any]]
    recommendations: List[str]
    alternatives: List[str]
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# Telegraph
TELEGRAPH_ACCESS_TOKEN=optional  # –ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω, —Å–æ–∑–¥–∞—Å—Ç—Å—è –Ω–æ–≤—ã–π

# LLM –¥–ª—è —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç–∏
OPENAI_API_KEY=your_key  # –î–ª—è –¥–µ—Ç–∞–ª—å–Ω—ã—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
CAPSULE_CHECK_INTERVAL=3600  # –°–µ–∫—É–Ω–¥—ã –º–µ–∂–¥—É –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏
DISTRESS_THRESHOLD=0.4       # –ü–æ—Ä–æ–≥ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ—Ä–æ–≥–æ–≤

```python
# src/letters/types.py
TOXICITY_THRESHOLDS = {
    LetterType.FOR_SENDING: 0.3,   # –ò–∑–º–µ–Ω–∏—Ç—å –∑–¥–µ—Å—å
    LetterType.TIME_CAPSULE: 0.5,
    LetterType.THERAPEUTIC: 1.0,
}
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã Sprint 9
pytest tests/test_sprint9_letters.py -v

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ç–µ—Å—Ç—ã
pytest tests/test_sprint9_letters.py::TestToxicityChecker -v
pytest tests/test_sprint9_letters.py::TestTelegraphClient -v
pytest tests/test_sprint9_letters.py::TestEnhancedLetterWriter -v
pytest tests/test_sprint9_letters.py::TestCapsuleMonitor -v

# –° –ø–æ–∫—Ä—ã—Ç–∏–µ–º
pytest tests/test_sprint9_letters.py --cov=src/letters --cov=src/integrations
```

### –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏

- ‚úÖ –¢–∏–ø—ã –ø–∏—Å–µ–º –∏ –ø–æ—Ä–æ–≥–∏
- ‚úÖ –¢–æ–∫—Å–∏—á–Ω–æ—Å—Ç—å (Detoxify + LLM)
- ‚úÖ Telegraph (—Å–æ–∑–¥–∞–Ω–∏–µ, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ, –ø–æ–ª—É—á–µ–Ω–∏–µ)
- ‚úÖ EnhancedLetterWriter (–≤—Å–µ —Å—Ç–∞–¥–∏–∏)
- ‚úÖ CapsuleMonitor (—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è)
- ‚úÖ Graceful degradation (–±–µ–∑ Detoxify, –±–µ–∑ LLM)

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### 1. Graceful Degradation

–í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ:
- –ù–µ—Ç Detoxify? ‚Üí –ò—Å–ø–æ–ª—å–∑—É–µ–º pattern matching
- –ù–µ—Ç LLM? ‚Üí –¢–æ–ª—å–∫–æ Detoxify
- –ù–µ—Ç Telegraph? ‚Üí –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–ª—å–∫–æ –≤ –ë–î
- –ù–µ—Ç Speech-to-Text? ‚Üí –¢–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç–æ–≤—ã–π –≤–≤–æ–¥

### 2. –ü—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å

**–ó–∞—â–∏—Ç–∞ –¥–∞–Ω–Ω—ã—Ö:**
- PII —É–¥–∞–ª—è–µ—Ç—Å—è –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π –Ω–∞ Telegraph
- UUID –≤ URL –¥–µ–ª–∞–µ—Ç —Å—Å—ã–ª–∫–∏ —Å–ª–æ–∂–Ω—ã–º–∏ –¥–ª—è –ø–æ–¥–±–æ—Ä–∞
- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –ø—É–±–ª–∏—á–Ω–æ—Å—Ç–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- –í–µ—Ä—Å–∏–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î (–∫–æ–Ω—Ç—Ä–æ–ª—å)

### 3. –ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å

**–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ, –Ω–æ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º:**
- –í—Å–µ –≤–µ—Ä—Å–∏–∏ –ø–∏—Å–µ–º —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
- –¢–æ–∫—Å–∏—á–Ω–æ—Å—Ç—å –ø–æ –≤—Ä–µ–º–µ–Ω–∏ —Ç—Ä–µ–∫–∞–µ—Ç—Å—è
- –ê–Ω–∞–ª–∏–∑ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏, –ù–ï –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤

### 4. –£–≤–∞–∂–µ–Ω–∏–µ –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

**–ü–æ–ª–Ω–∞—è —Å–≤–æ–±–æ–¥–∞ –≤—ã–±–æ—Ä–∞:**
- –°–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞–µ—Ç, –Ω–æ –ù–ï –∑–∞–ø—Ä–µ—â–∞–µ—Ç
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–µ—à–∞–µ—Ç: —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å
- –ù–∏–∫–∞–∫–∏—Ö –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏–π
- –¢–µ—Ä–∞–ø–µ–≤—Ç–∏—á–µ—Å–∫–∏–µ –ø–∏—Å—å–º–∞ - –ø–æ–ª–Ω–∞—è —Å–≤–æ–±–æ–¥–∞

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Sprint 8

Sprint 9 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏–∑ Sprint 8:

- **Entity Recognition** ‚Üí –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏–º—ë–Ω, –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π –≤ –ø–∏—Å—å–º–∞—Ö
- **Intent Classification** ‚Üí –ü–æ–Ω–∏–º–∞–Ω–∏–µ —Ü–µ–ª–∏ –ø–∏—Å—å–º–∞
- **Speech-to-Text** ‚Üí –ì–æ–ª–æ—Å–æ–≤–∞—è –¥–∏–∫—Ç–æ–≤–∫–∞

## Roadmap

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ ‚úÖ
- –¢—Ä–∏ —Ç–∏–ø–∞ –ø–∏—Å–µ–º
- –î–≤—É—Ö—ç—Ç–∞–ø–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç–∏
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Telegraph
- –ì–æ–ª–æ—Å–æ–≤–∞—è –¥–∏–∫—Ç–æ–≤–∫–∞
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–∞–ø—Å—É–ª
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
- –¢–µ—Å—Ç—ã

### –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è üîÆ
- –®–∞–±–ª–æ–Ω—ã –ø–∏—Å–µ–º (–¥–ª—è —Å—É–¥–∞, —à–∫–æ–ª—ã)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–µ—Ä–µ–≤–æ–¥—ã (–¥–ª—è international cases)
- –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –¥–∏–Ω–∞–º–∏–∫–∏
- –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- –ö–æ–ª–ª–∞–±–æ—Ä–∞—Ç–∏–≤–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (—Å —Ç–µ—Ä–∞–ø–µ–≤—Ç–æ–º)
- –≠–∫—Å–ø–æ—Ä—Ç –≤ PDF

## Troubleshooting

### Detoxify –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

```python
# –ü—Ä–æ–≤–µ—Ä–∫–∞
from src.letters.toxicity_checker import DETOXIFY_AVAILABLE
print(DETOXIFY_AVAILABLE)  # False ‚Üí —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å detoxify

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞
pip install detoxify
```

### Telegraph –æ—à–∏–±–∫–∏ 403

```python
# –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω
client = TelegraphClient()
await client.initialize()  # –°–æ–∑–¥–∞—Å—Ç –Ω–æ–≤—ã–π –∞–∫–∫–∞—É–Ω—Ç
```

### LLM —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø—É—Å—Ç—ã–µ

```python
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å API key
import os
print(os.getenv('OPENAI_API_KEY'))  # None ‚Üí –¥–æ–±–∞–≤–∏—Ç—å –≤ .env
```

### –ì–æ–ª–æ—Å–æ–≤—ã–µ –Ω–µ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä—É—é—Ç—Å—è

```python
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Speech Handler
from src.nlp.speech_handler import SpeechHandler
handler = SpeechHandler()
print(handler.is_available())  # False ‚Üí –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å Speech-to-Text
```

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –ú–µ—Ç—Ä–∏–∫–∏

- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç–∏: ~1-2 —Å–µ–∫ (Detoxify + LLM)
- –°–æ–∑–¥–∞–Ω–∏–µ Telegraph: ~0.5 —Å–µ–∫
- –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è –≥–æ–ª–æ—Å–∞: ~3-5 —Å–µ–∫
- –ü–æ–ª–Ω—ã–π flow: ~5-10 —Å–µ–∫

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

- Detoxify –∫—ç—à–∏—Ä—É–µ—Ç –º–æ–¥–µ–ª—å
- Telegraph –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–¥–∏–Ω –∞–∫–∫–∞—É–Ω—Ç
- LLM –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç–∏
- Async/await –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ó–∞—â–∏—â—ë–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

- ‚ùå –ù–µ –∑–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞ Telegraph: —Ç–µ–ª–µ—Ñ–æ–Ω—ã, –∞–¥—Ä–µ—Å–∞, –ø–∞—Å–ø–æ—Ä—Ç–∞
- ‚úÖ –ó–∞–≥—Ä—É–∂–∞–µ–º: —ç–º–æ—Ü–∏–∏, –∏—Å—Ç–æ—Ä–∏–∏, –ø–ª–∞–Ω—ã
- üîê –í–µ—Ä—Å–∏–∏ –≤ –ë–î: –ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å PII

### –ê—É–¥–∏—Ç

–í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è:
- –°–æ–∑–¥–∞–Ω–∏–µ –ø–∏—Å–µ–º
- –ü—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–ø—Å—É–ª
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- –≠—Ç–æ—Ç —Ñ–∞–π–ª: `docs/SPRINT9_TELEGRAPH_LETTERS.md`
- –¢–µ—Å—Ç—ã: `tests/test_sprint9_letters.py`
- –ü—Ä–∏–º–µ—Ä—ã: —Å–º. —Ä–∞–∑–¥–µ–ª "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ"

### –ö–æ–¥
- Letter types: `src/letters/types.py`
- Toxicity: `src/letters/toxicity_checker.py`
- Telegraph: `src/integrations/telegraph_client.py`
- Writer: `src/letters/enhanced_writer.py`
- Monitor: `src/letters/capsule_monitor.py`
- Handlers: `src/core/letter_handlers.py`

---

**Sprint 9 –∑–∞–≤–µ—Ä—à—ë–Ω** ‚úÖ

–°–æ–∑–¥–∞–Ω–æ: 2025-11
–í–µ—Ä—Å–∏—è: 1.0
